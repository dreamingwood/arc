<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <script src="echarts.js"></script>
      <script src="/jquery/jquery-3.1.0.min.js"></script>
</head>
<body>

    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="width: 600px;height:400px;"></div>


        <button class="btn btn-primary" type="button" onclick="change_sth()">查询</button>

        <script type="text/javascript">
            var tree;
        function change_sth(){
           // alert(sum2(5));

           $("#main").text("hello");
           getdata();
           tree=arry2tree(datatest,'a');

       };

       function sum2(num){
            if(num>1){
                return num + sum2(num-1);

            }else{
                return 1;
            };

       };








 function arry2tree(data, sfl) {
    var result = [], temp;
    for (var i = 0; i < data.length; i++) {
        if (data[i].sfl == sfl) {
            var obj = {"mc": data[i].mc,"fl": data[i].fl};
            temp = arry2tree(data, data[i].fl);
            if (temp.length > 0) {
                obj.children = temp;
            }
            result.push(obj);
        }
    }
    return result;
}



//var tree2 = arry2tree (nodes,0);

 //alert(tree2);



        </script>



<script>
var datatest;
    function getdata(){
        $("#main").html("begin");
                var jqxhr = $.get('http://localhost:3000/statistics/api_info?dwmc=全局', {
                   

            }).done(function (data) {
                datatest = data;
              //  show_chart(data);//画图

            }).fail(function (xhr, status) {
                   // ajaxLog('失败: ' + xhr.status + ', 原因: ' + status);
                    $("#main").html("fails" + xhr.status + ', 原因: ' + status);
            }).always(function () {
                   // ajaxLog('__dwbh' + str_dwbh + ',wzbh:' + str_wzbh + ',search:'  +str_serach_str);
                 //  $("#ajaxdata2").html("always");
            });
    };






</script>



</body>
</html>