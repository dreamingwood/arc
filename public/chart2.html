<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>

      <script src="/jquery/jquery-3.1.0.min.js"></script>
      <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">


</head>
<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="main" style="height:400px"></div>
    <!-- ECharts单文件引入 -->
    <script src="/echarts/echarts.js"></script>

<div id = "ajaxdata2" class = "ajaxdata">
    ajaxdata
</div>
 <button class="btn btn-primary" type="button" onclick="show_chart()">显示图表</button>

    <script>
        $(document).ready(function () {
            getdata();
        });
 var myChart;
 var option;
 var datatest;
 var dw_list; // 单位列表
</script>




    <script type="text/javascript">
        // 路径配置  配置下面三行，注意使用绝对路径
        require.config({
            paths: {
                echarts: '/echarts'   
            }
        });
        
        // 使用
        require(
            [
                'echarts',
                'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ],
            function (ec) {
                // 基于准备好的dom，初始化echarts图表
                 myChart = ec.init(document.getElementById('main')); 
                
                 option = {
                    tooltip: {
                        show: true
                    },
                    legend: {
                        data:['销量','销量','销量']
                    },
                    xAxis : [
                        {
                            type : 'category',
                            data : ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
                        },
                        {
                            type : 'category2',
                            data : ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
                        },
                        {
                            type : 'category3',
                            data : ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
                        }
                    ],
                    yAxis : [
                        {
                            type : '万元'
                        },
                         {
                            type : '万元2'
                        },
                        {
                            type : '万元3'
                        }

                    ],
                    series : [
                        {
                            "name":"库存",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        },
                        {
                            "name":"库存2",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        },
                        {
                            "name":"库存3",
                            "type":"bar",
                            "data":[5, 20, 40, 10, 10, 20]
                        }
                    ]
                };
              
        
               // 为echarts对象加载数据 
              // myChart.setOption(option); 

            }
        );

    </script>




<script>

    //获取图标函数，ajax 获取数据成功后画图

    function show_one_chart(data){



                option.series[0].data =[]; //清空数值
               // option.xAxis = new array(3)
                option.xAxis[0].data = []; 
                //datatest = data;
                 option.legend.data[0] = data[0].SUNITNAME;   //设置图例
                 //给x轴标签，数据赋值
                for(var i=0; i<data.length; i++)
                {
                    option.series[0].data.push(data[i].NNOWAMOUNT);
                    option.xAxis[0].data.push(data[i].SYEARMONTH);
                };

                myChart.setOption(option);  //设置图表
    };
   


    function show_chart(data){

                 option.tooltip = {
                        show: true
                    };


              dw_list=[];
            //   dw_list.push(data[1].SUNITNAME);
            //   dw_list.push(data[12].SUNITNAME);
             //  if(dw_list.some(data[3].SUNITNAME))  dw_list.push(data[3].SUNITNAME );
                for(var d=0; d< data.length ; d++)
                {
                    if(dw_list.indexOf(data[d].SUNITNAME) == -1 ) dw_list.push(data[d].SUNITNAME );
                    
                };

                option.legend.data = [];
        
                for(var dw =0; dw< dw_list.length; dw++)
                {
                    option.series[dw].data =[]; //清空数值
                    option.xAxis[dw].data = []; 
                    
                    //datatest = data;
                    option.legend.data.push(dw_list[dw]);   //设置图例
                   // 给x轴标签，数据赋值
                    for(var i=0; i<data.length; i++)
                    {
                        if(data[i].SUNITNAME == dw_list[dw]){
                            option.series[dw].data.push(data[i].NNOWAMOUNT);
                            option.xAxis[dw].data.push(data[i].SYEARMONTH);
                        };
                    };
                    
                    
                };   
        
        //show_one_chart(data);
         myChart.setOption(option);  //设置图表


    };

</script>













<script>

    function getdata(){
        $("#ajaxdata2").html("begin");
                var jqxhr = $.get('/statistics/api_kucun_summary_all', {

            }).done(function (data) {
                datatest = data;
                show_chart(data);//画图

            }).fail(function (xhr, status) {
                   // ajaxLog('失败: ' + xhr.status + ', 原因: ' + status);
                    $("#ajaxdata2").html("fails");
            }).always(function () {
                   // ajaxLog('__dwbh' + str_dwbh + ',wzbh:' + str_wzbh + ',search:'  +str_serach_str);
                 //  $("#ajaxdata2").html("always");
            });
    };






</script>


      <script src="/bootstrap/js/bootstrap.min.js"></script>


</body>